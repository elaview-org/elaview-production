{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": {
    "nodejs": {
      "version": "22"
    },
    "pnpm": {
      "version": "latest"
    },
    "bun": {
      "version": "latest"
    },
    "git": {
      "version": "latest"
    },
    "docker": {
      "version": "latest"
    },
    "curl": {
      "version": "latest"
    }
  },
  "shell": {
    "init_hook": [
      "echo -e \"\\n\\033[33mInfo:\\033[0m Importing environment variables from '$(git rev-parse --show-toplevel)/.env'.\\n\"",
      "REPO_ROOT=$(git rev-parse --show-toplevel)",
      "export $(grep '^WEB_' \"$REPO_ROOT/.env\" | sed 's/^WEB_//')",
      "grep '^WEB_' \"$REPO_ROOT/.env\" | sed 's/^WEB_//'",
      "echo -e \"\\n\\033[33mInfo:\\033[0m Checking dependencies via Bun.\\n\"",
      "bun install",
      "echo -e \"\\n\\033[32mInfo:\\033[0m Welcome to Devbox Shell!\""
    ],
    "scripts": {
      "env": [
        "REPO_ROOT=$(git rev-parse --show-toplevel)",
        "grep '^WEB_' \"$REPO_ROOT/.env\" | sed 's/^WEB_//' > .env"
      ],
      "dev": "bun run dev",
      "build": "bun run build",
      "lint": "bun run lint",
      "format": "bun run format",
      "backend:start": "docker compose -f ../../backend/docker-compose.yaml up --build -d",
      "backend:stop": "docker compose -f ../../backend/docker-compose.yaml down --remove-orphans",
      "backend:logs": "docker compose -f ../../backend/docker-compose.yaml logs -f",
      "backend:wait": [
        "echo 'Waiting for backend to be ready...'",
        "until curl -sf ${NEXT_PUBLIC_API_URL}/graphql -o /dev/null 2>&1; do",
        "  echo 'Backend not ready, retrying in 1s...'",
        "  sleep 1",
        "done",
        "echo 'Backend is ready!'"
      ],
      "gql:codegen": "bun run gql:codegen",
      "setup": [
        "echo '=== Starting backend ==='",
        "devbox run backend:start",
        "echo 'Waiting for backend to be ready...'",
        "until curl -sf ${NEXT_PUBLIC_API_URL}/graphql -o /dev/null 2>&1; do",
        "  echo 'Backend not ready, retrying in 1s...'",
        "  sleep 1",
        "done",
        "echo 'Backend is ready!'",
        "echo '=== Running GraphQL codegen ==='",
        "devbox run gql:codegen",
        "echo '=== Stopping backend ==='",
        "devbox run backend:stop",
        "echo '=== Setup complete ==='"
      ]
    }
  }
}
